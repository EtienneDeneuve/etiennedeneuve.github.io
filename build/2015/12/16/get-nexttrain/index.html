<!doctype html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
    

    <title>XYZ Blog</title>
    <script defer src="https://use.fontawesome.com/releases/v5.7.2/js/all.js" integrity="sha384-0pzryjIRos8mFBWMzSSZApWtPl/5++eIfzYmTgBBmXYdhvxPc+XcFEk+zJwDgWbP" crossorigin="anonymous"></script>

    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

    
      <script src="https://cdn.jsdelivr.net/npm/vue@2.6.10/dist/vue.min.js"></script>
    

    <script src="/js/script.js"></script>
    </head>
  <body class="position-relative" data-spy="scroll" data-target=".site-nav" data-offset="55">
    <nav class="site-nav family-sans navbar navbar-expand-md navbar-dark  sidebar sticky-top  py-0">
  <div class="container-fluid">
    <button type="button" class="navbar-toggler my-2 my-md-0" data-toggle="collapse" data-target="#myTogglerNav" aria-controls="myTogglerNav" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="navbar-brand text-uppercase">
      <a class="text-light" href="/"><i class="fas fa-cube mr-2"></i>XYZ Blog</a> 
    </div>

    <div class="collapse navbar-collapse text-center mt-0" id="myTogglerNav">
      <div class="navbar-nav ml-auto font-weight-regular text-uppercase">
        
        <a class="d-none nav-item nav-link" href="#page-hero">hero target</a>
        <a class="d-none nav-item nav-link" href="#main-content">nav target</a>
        
        <a class="nav-item nav-link font-weight-bold  text-light" href="/"><i class="fas fa-home"></i></a>
        
          <a class="nav-item nav-link" href="/courses/0/">courses</a>
          
          <a class="nav-item nav-link" href="/posts/0/">posts</a>
          <div class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Projects
          </a>
          <div class="dropdown-menu dropdown-menu-right" aria-labelledby="userDropdown">




          <a class="dropdown-item text-capitalize text-normal" href="/projects/seven/"><i class="fas fa-atom"></i> seven</a><a class="dropdown-item text-capitalize text-normal" href="/projects/rayveal/"><i class="fas fa-atom"></i> rayveal</a></div>
        </div>
        <div class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <i class="fas fa-user"></i>
          </a>
          <div class="dropdown-menu dropdown-menu-right" aria-labelledby="userDropdown">
            <a class="dropdown-item text-capitalize" href="/about">About Me</a>
            <div class="dropdown-divider"></div><a class="dropdown-item text-capitalize" target="_blank" href="https://github.com/etiennedeneuve">
            <i class="fab fa-github text-secondary mr-2"></i>github
          </a><a class="dropdown-item text-capitalize" target="_blank" href="https://linkedin.com/in/etiennedeneuve">
            <i class="fab fa-linkedin text-secondary mr-2"></i>linkedin
          </a><a class="dropdown-item text-capitalize" target="_blank" href="https://twitter.com/etiennedinfo">
            <i class="fab fa-twitter text-secondary mr-2"></i>twitter
          </a></div>
        </div>
      </div>
      <div class="searchbox pl-2 py-2">
    <input
      type="text"
      v-model="query"
      class="form-control text-white border m-auto"
      :class="[isActive ? 'wide' : 'short']"
      @focus="isActive=true"
      @blur.prevent="handleBlur"
      ref="searchinput"
      style="background: transparent;"
      aria-describedby="searchinput"
      autocomplete="off"
    >
    <div v-if="query && isActive" class="position-absolute justify-content-center" style="top: 47px;">
      <div class="card bg-secondary">
        <ul class="list-group list-group-flush px-0" v-for="(item, index) in queried" :key="index">
          <li class="list-group-item">
            <a :href="item.url" class="d-flex text-secondary">
              <span class="pr-2" v-html="item.icon"></span>
              <span class="text-body text-left" v-html="item.title"></span>
            </a>
          </li>
        </ul>
      </div>
    </div>
</div>
    </div>
  </div>
</nav>

      

 
  <div class="post post-sidebar container-fluid">
    <div class="row justify-content-xl-center">
      <aside class="aside aside-main d-none d-md-block col-md-3 col-lg-2">
        <nav class="sticky-top list-group list-group-flush text-right" id="collapseExample">

          </nav>
      </aside>


      <main class="main col">
      <h1 id="let's-play-with-sncf-api-and-powershell-!">Let's play with SNCF Api and Powershell ! <a class="direct-link" href="#let's-play-with-sncf-api-and-powershell-!"> </a></h1>
<p>My goal was to get a list of the next train in the train station near my home, from powershell...</p>
<p>My functions are below, feel free to leave a comment, copy it, it's free ! (Now on Github ! <a href="https://github.com/EtienneDeneuve/Powershell/blob/master/GetNextTrain/TheScript.ps1">git it !</a></a>)</p>
<p>Of course, it's not a serious post, but more is coming ;)</p>
<p>You can try this :</p>
<pre class="language-powershell"><code class="language-powershell"><span class="highlight-line"><span class="token punctuation">(</span>Get<span class="token operator">-</span>gare <span class="token operator">-</span>gare <span class="token string">"clamart"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>idgare <span class="token punctuation">|</span> Get<span class="token operator">-</span>TrainDirection <span class="token punctuation">|</span><span class="token operator">%</span><span class="token punctuation">{</span> Get<span class="token operator">-</span>NextTrain <span class="token operator">-</span>idgare <span class="token variable">$_</span><span class="token punctuation">.</span>idgare <span class="token operator">-</span>traindirection <span class="token variable">$_</span><span class="token punctuation">.</span>direction <span class="token punctuation">}</span> <span class="token punctuation">|</span> <span class="token function">FT</span></span><br><span class="highlight-line">ETADeparture Direction ETAArrival ETAinMin <span class="token keyword">From</span> GareName</span><br><span class="highlight-line"><span class="token operator">--</span>-<span class="token operator">--</span>-<span class="token operator">--</span>-<span class="token operator">--</span><span class="token operator">-</span> <span class="token operator">--</span>-<span class="token operator">--</span>-<span class="token operator">--</span><span class="token operator">-</span> <span class="token operator">--</span>-<span class="token operator">--</span>-<span class="token operator">--</span>-<span class="token operator">-</span> <span class="token operator">--</span>-<span class="token operator">--</span>-<span class="token operator">--</span> <span class="token operator">--</span>-<span class="token operator">-</span> <span class="token operator">--</span>-<span class="token operator">--</span>-<span class="token operator">--</span></span><br><span class="highlight-line">16<span class="token operator">/</span>12<span class="token operator">/</span>2015 13:49:00 Paris<span class="token operator">-</span>Montparnasse 1<span class="token operator">-</span>2 <span class="token punctuation">(</span>Paris<span class="token punctuation">)</span> 16<span class="token operator">/</span>12<span class="token operator">/</span>2015 13:49:00 0:1:18 Rambouillet vers Paris<span class="token operator">-</span>Montparnasse 1<span class="token operator">-</span>2 gare de Clamart</span><br><span class="highlight-line">16<span class="token operator">/</span>12<span class="token operator">/</span>2015 14:04:00 Paris<span class="token operator">-</span>Montparnasse 1<span class="token operator">-</span>2 <span class="token punctuation">(</span>Paris<span class="token punctuation">)</span> 16<span class="token operator">/</span>12<span class="token operator">/</span>2015 14:04:00 0:16:18 Mantes<span class="token operator">-</span>la<span class="token operator">-</span>Jolie vers Paris<span class="token operator">-</span>Montparnasse 1<span class="token operator">-</span>2 gare de Clamart</span><br><span class="highlight-line">16<span class="token operator">/</span>12<span class="token operator">/</span>2015 14:19:00 Paris<span class="token operator">-</span>Montparnasse 1<span class="token operator">-</span>2 <span class="token punctuation">(</span>Paris<span class="token punctuation">)</span> 16<span class="token operator">/</span>12<span class="token operator">/</span>2015 14:19:00 0:31:18 Rambouillet vers Paris<span class="token operator">-</span>Montparnasse 1<span class="token operator">-</span>2 gare de Clamart</span><br><span class="highlight-line">16<span class="token operator">/</span>12<span class="token operator">/</span>2015 14:34:00 Paris<span class="token operator">-</span>Montparnasse 1<span class="token operator">-</span>2 <span class="token punctuation">(</span>Paris<span class="token punctuation">)</span> 16<span class="token operator">/</span>12<span class="token operator">/</span>2015 14:34:00 0:46:18 Plaisir<span class="token operator">-</span>Grignon vers Paris<span class="token operator">-</span>Montparnasse 1<span class="token operator">-</span>2 gare de Clamart</span><br><span class="highlight-line">16<span class="token operator">/</span>12<span class="token operator">/</span>2015 14:49:00 Paris<span class="token operator">-</span>Montparnasse 1<span class="token operator">-</span>2 <span class="token punctuation">(</span>Paris<span class="token punctuation">)</span> 16<span class="token operator">/</span>12<span class="token operator">/</span>2015 14:49:00 1:1:18 Rambouillet vers Paris<span class="token operator">-</span>Montparnasse 1<span class="token operator">-</span>2 gare de Clamart</span><br><span class="highlight-line">16<span class="token operator">/</span>12<span class="token operator">/</span>2015 13:57:00 Mantes<span class="token operator">-</span>la<span class="token operator">-</span>Jolie <span class="token punctuation">(</span>Mantes<span class="token operator">-</span>la<span class="token operator">-</span>Jolie<span class="token punctuation">)</span> 16<span class="token operator">/</span>12<span class="token operator">/</span>2015 13:57:00 0:9:18 Paris<span class="token operator">-</span>Montparnasse 1<span class="token operator">-</span>2 vers Mantes<span class="token operator">-</span>la<span class="token operator">-</span>Jolie gare de Clamart</span><br><span class="highlight-line">16<span class="token operator">/</span>12<span class="token operator">/</span>2015 14:57:00 Mantes<span class="token operator">-</span>la<span class="token operator">-</span>Jolie <span class="token punctuation">(</span>Mantes<span class="token operator">-</span>la<span class="token operator">-</span>Jolie<span class="token punctuation">)</span> 16<span class="token operator">/</span>12<span class="token operator">/</span>2015 14:57:00 1:9:18 Paris<span class="token operator">-</span>Montparnasse 1<span class="token operator">-</span>2 vers Mantes<span class="token operator">-</span>la<span class="token operator">-</span>Jolie gare de Clamart</span><br><span class="highlight-line">16<span class="token operator">/</span>12<span class="token operator">/</span>2015 14:12:00 Rambouillet <span class="token punctuation">(</span>Rambouillet<span class="token punctuation">)</span> 16<span class="token operator">/</span>12<span class="token operator">/</span>2015 14:12:00 0:24:17 Paris<span class="token operator">-</span>Montparnasse 1<span class="token operator">-</span>2 vers Rambouillet gare de Clamart</span><br><span class="highlight-line">16<span class="token operator">/</span>12<span class="token operator">/</span>2015 14:42:00 Rambouillet <span class="token punctuation">(</span>Rambouillet<span class="token punctuation">)</span> 16<span class="token operator">/</span>12<span class="token operator">/</span>2015 14:42:00 0:54:17 Paris<span class="token operator">-</span>Montparnasse 1<span class="token operator">-</span>2 vers Rambouillet gare de Clamart</span><br><span class="highlight-line">16<span class="token operator">/</span>12<span class="token operator">/</span>2015 14:27:00 Plaisir<span class="token operator">-</span>Grignon <span class="token punctuation">(</span>Plaisir<span class="token punctuation">)</span> 16<span class="token operator">/</span>12<span class="token operator">/</span>2015 14:27:00 0:39:18 Paris<span class="token operator">-</span>Montparnasse 1<span class="token operator">-</span>2 vers Plaisir<span class="token operator">-</span>Grignon gare de Clamart</span></code></pre>
<pre class="language-powershell"><code class="language-powershell"><span class="highlight-line"><span class="token keyword">Function</span> Get<span class="token operator">-</span>NextTrain</span><br><span class="highlight-line"><span class="token punctuation">{</span></span><br><span class="highlight-line"><span class="token namespace">[cmdletbinding()]</span></span><br><span class="highlight-line"><span class="token keyword">param</span><span class="token punctuation">(</span></span><br><span class="highlight-line"><span class="token namespace">[Parameter(Mandatory = $true, ValueFromPipeline=$true)]</span></span><br><span class="highlight-line"><span class="token variable">$idgare</span><span class="token punctuation">,</span></span><br><span class="highlight-line"><span class="token namespace">[Parameter(Mandatory = $true, ValueFromPipeline=$true)]</span></span><br><span class="highlight-line"><span class="token variable">$traindirection</span><span class="token punctuation">,</span></span><br><span class="highlight-line"><span class="token variable">$apikey</span> = <span class="token string">'YourApiKeyfromapisncfwebsite'</span></span><br><span class="highlight-line"><span class="token punctuation">)</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token variable">$datenow</span> = <span class="token function">Get-date</span> <span class="token operator">-</span>Format yyyyMMddTHHmmss</span><br><span class="highlight-line"><span class="token variable">$params2</span> = @<span class="token punctuation">{</span>uri = <span class="token string">"https://api.sncf.com/v1/coverage/sncf/stop_areas/<span class="token function">$<span class="token punctuation">(</span><span class="token variable">$idgare</span><span class="token punctuation">)</span></span>/departures?from_datetime=<span class="token function">$<span class="token punctuation">(</span><span class="token variable">$datenow</span><span class="token punctuation">)</span></span>"</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">               Method = <span class="token string">'Get'</span><span class="token punctuation">;</span> <span class="token comment">#(or POST, or whatever)</span></span><br><span class="highlight-line">               Headers = @<span class="token punctuation">{</span>Authorization = <span class="token string">'Basic '</span> <span class="token operator">+</span> <span class="token namespace">[Convert]</span>::ToBase64String<span class="token punctuation">(</span><span class="token namespace">[Text.Encoding]</span>::ASCII<span class="token punctuation">.</span>GetBytes<span class="token punctuation">(</span><span class="token string">"<span class="token function">$<span class="token punctuation">(</span><span class="token variable">$apikey</span><span class="token punctuation">)</span></span>:"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">       <span class="token punctuation">}</span> <span class="token comment">#end headers hash table</span></span><br><span class="highlight-line">   <span class="token punctuation">}</span> <span class="token comment">#end $params hash table</span></span><br><span class="token variable">$string</span> = @<span class="token string">"<br><span class="highlight-line">Liste des prochains trains pour {0} en provenance de {1} doit arriver a la {2} a {3} et partir a {4}</span><br>"</span>@<br><span class="highlight-line"><span class="token variable">$var2</span> = <span class="token function">invoke-restmethod</span> @params2</span><br><span class="highlight-line"><span class="token variable">$alltrain</span> = <span class="token punctuation">,</span>@<span class="token punctuation">(</span><span class="token punctuation">)</span></span><br><span class="highlight-line"><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$departure</span> in $<span class="token punctuation">(</span><span class="token variable">$var2</span><span class="token punctuation">.</span>departures<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span><br><span class="highlight-line">   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$departure</span><span class="token punctuation">.</span>display_informations<span class="token punctuation">.</span>direction <span class="token operator">-like</span> $<span class="token punctuation">(</span><span class="token variable">$traindirection</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token variable">$direction</span> = $<span class="token punctuation">(</span><span class="token variable">$departure</span><span class="token punctuation">.</span>display_informations<span class="token punctuation">.</span>direction <span class="token operator">-replace</span> <span class="token string">"gare de "</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span> <span class="token operator">-replace</span> <span class="token string">" 1-2 (Paris)"</span><span class="token punctuation">,</span><span class="token string">""</span></span><br><span class="highlight-line">    <span class="token namespace">[datetime]</span><span class="token variable">$convertarrival</span> = ConvertTo<span class="token operator">-</span>SncfDateTime <span class="token operator">-</span>sncfdate $<span class="token punctuation">(</span><span class="token variable">$departure</span><span class="token punctuation">.</span>stop_date_time<span class="token punctuation">.</span>arrival_date_time<span class="token punctuation">)</span></span><br><span class="highlight-line">    <span class="token namespace">[datetime]</span><span class="token variable">$convertdeparture</span> = ConvertTo<span class="token operator">-</span>SncfDateTime <span class="token operator">-</span>sncfdate $<span class="token punctuation">(</span><span class="token variable">$departure</span><span class="token punctuation">.</span>stop_date_time<span class="token punctuation">.</span>departure_date_time<span class="token punctuation">)</span></span><br><span class="highlight-line">    <span class="token namespace">[timespan]</span><span class="token variable">$timefromnow</span> = <span class="token function">NEW-TIMESPAN</span> –<span class="token function">Start</span> $<span class="token punctuation">(</span><span class="token function">Get-date</span><span class="token punctuation">)</span> –<span class="token keyword">End</span> <span class="token variable">$convertarrival</span></span><br><span class="highlight-line">    <span class="token variable">$hash</span> = @<span class="token punctuation">{</span></span><br><span class="highlight-line">        Direction = $<span class="token punctuation">(</span><span class="token variable">$direction</span><span class="token punctuation">)</span></span><br><span class="highlight-line">        <span class="token keyword">From</span> = $<span class="token punctuation">(</span><span class="token variable">$departure</span><span class="token punctuation">.</span>route<span class="token punctuation">.</span>name<span class="token punctuation">)</span></span><br><span class="highlight-line">        GareName = $<span class="token punctuation">(</span><span class="token variable">$departure</span><span class="token punctuation">.</span>stop_point<span class="token punctuation">.</span>name<span class="token punctuation">)</span></span><br><span class="highlight-line">        ETAArrival = $<span class="token punctuation">(</span><span class="token variable">$convertarrival</span><span class="token punctuation">)</span></span><br><span class="highlight-line">        ETADeparture =  $<span class="token punctuation">(</span><span class="token variable">$convertdeparture</span><span class="token punctuation">)</span></span><br><span class="highlight-line">        ETAinMin =  <span class="token string">"<span class="token function">$<span class="token punctuation">(</span><span class="token variable">$timefromnow</span><span class="token punctuation">.</span>Hours<span class="token punctuation">)</span></span>:<span class="token function">$<span class="token punctuation">(</span><span class="token variable">$timefromnow</span><span class="token punctuation">.</span>Minutes<span class="token punctuation">)</span></span>:<span class="token function">$<span class="token punctuation">(</span><span class="token variable">$timefromnow</span><span class="token punctuation">.</span>Seconds<span class="token punctuation">)</span></span>"</span></span><br><span class="highlight-line">    <span class="token punctuation">}</span></span><br><span class="highlight-line">        <span class="token variable">$Object</span> = <span class="token function">New-Object</span> PSObject <span class="token operator">-</span>Property <span class="token variable">$hash</span></span><br><span class="highlight-line">        <span class="token variable">$alltrain</span> <span class="token operator">+=</span> <span class="token variable">$Object</span></span><br><span class="highlight-line">     <span class="token punctuation">}</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span><br><span class="highlight-line"><span class="token keyword">return</span> <span class="token variable">$alltrain</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">Function</span> Get<span class="token operator">-</span>TrainDirection</span><br><span class="highlight-line"><span class="token punctuation">{</span></span><br><span class="highlight-line"> <span class="token namespace">[cmdletbinding()]</span></span><br><span class="highlight-line"><span class="token keyword">param</span><span class="token punctuation">(</span></span><br><span class="highlight-line"><span class="token namespace">[Parameter(Mandatory = $true, ValueFromPipeline=$true)]</span></span><br><span class="highlight-line"><span class="token namespace">[string]</span><span class="token variable">$idgare</span><span class="token punctuation">,</span></span><br><span class="highlight-line"><span class="token variable">$apikey</span> = <span class="token string">'YourApiKeyfromapisncfwebsite'</span></span><br><span class="highlight-line"><span class="token punctuation">)</span></span><br><span class="highlight-line"><span class="token variable">$datenow</span> = <span class="token function">Get-date</span> <span class="token operator">-</span>Format yyyyMMddTHHmmss</span><br><span class="highlight-line"><span class="token variable">$params2</span> = @<span class="token punctuation">{</span>uri = <span class="token string">"https://api.sncf.com/v1/coverage/sncf/stop_areas/<span class="token function">$<span class="token punctuation">(</span><span class="token variable">$idgare</span><span class="token punctuation">)</span></span>/departures?from_datetime=<span class="token function">$<span class="token punctuation">(</span><span class="token variable">$datenow</span><span class="token punctuation">)</span></span>"</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">                   Method = <span class="token string">'Get'</span><span class="token punctuation">;</span> <span class="token comment">#(or POST, or whatever)</span></span><br><span class="highlight-line">                   Headers = @<span class="token punctuation">{</span>Authorization = <span class="token string">'Basic '</span> <span class="token operator">+</span> <span class="token namespace">[Convert]</span>::ToBase64String<span class="token punctuation">(</span><span class="token namespace">[Text.Encoding]</span>::ASCII<span class="token punctuation">.</span>GetBytes<span class="token punctuation">(</span><span class="token string">"<span class="token function">$<span class="token punctuation">(</span><span class="token variable">$apikey</span><span class="token punctuation">)</span></span>:"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">           <span class="token punctuation">}</span> <span class="token comment">#end headers hash table</span></span><br><span class="highlight-line">   <span class="token punctuation">}</span> <span class="token comment">#end $params hash table</span></span><br><span class="highlight-line"><span class="token variable">$var2</span> = <span class="token function">invoke-restmethod</span> @params2</span><br><span class="highlight-line"><span class="token variable">$direction</span> = <span class="token punctuation">,</span>@<span class="token punctuation">(</span><span class="token punctuation">)</span></span><br><span class="highlight-line"><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$departure</span> in $<span class="token punctuation">(</span><span class="token variable">$var2</span><span class="token punctuation">.</span>departures<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token variable">$hash</span> = @<span class="token punctuation">{</span></span><br><span class="highlight-line">        Direction = $<span class="token punctuation">(</span><span class="token variable">$departure</span><span class="token punctuation">.</span>display_informations<span class="token punctuation">.</span>direction<span class="token punctuation">.</span>ToString<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span><br><span class="highlight-line">        idgare = $<span class="token punctuation">(</span><span class="token variable">$idgare</span><span class="token punctuation">)</span></span><br><span class="highlight-line">    <span class="token punctuation">}</span></span><br><span class="highlight-line">    <span class="token variable">$Object</span> = <span class="token function">New-Object</span> PSObject <span class="token operator">-</span>Property <span class="token variable">$hash</span></span><br><span class="highlight-line">    <span class="token variable">$direction</span> <span class="token operator">+=</span> <span class="token variable">$Object</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span><br><span class="highlight-line"><span class="token variable">$direction</span> <span class="token punctuation">|</span> <span class="token function">Select-Object</span> idgare<span class="token punctuation">,</span>direction <span class="token operator">-</span>Unique  <span class="token operator">-</span>Skip 1</span><br><span class="highlight-line"><span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">Function</span> Get<span class="token operator">-</span>Gare</span><br><span class="highlight-line"><span class="token punctuation">{</span></span><br><span class="highlight-line"><span class="token keyword">param</span><span class="token punctuation">(</span></span><br><span class="highlight-line"><span class="token variable">$gare</span><span class="token punctuation">,</span></span><br><span class="highlight-line"><span class="token variable">$apikey</span> = <span class="token string">'YourApiKeyfromapisncfwebsite'</span></span><br><span class="highlight-line"><span class="token punctuation">)</span></span><br><span class="highlight-line"><span class="token variable">$params</span> = @<span class="token punctuation">{</span>uri = <span class="token string">"https://api.sncf.com/v1/coverage/sncf/places?q=<span class="token function">$<span class="token punctuation">(</span><span class="token variable">$gare</span><span class="token punctuation">)</span></span>"</span><span class="token punctuation">;</span></span><br><span class="highlight-line">               Method = <span class="token string">'Get'</span><span class="token punctuation">;</span> <span class="token comment">#(or POST, or whatever)</span></span><br><span class="highlight-line">               Headers = @<span class="token punctuation">{</span>Authorization = <span class="token string">'Basic '</span> <span class="token operator">+</span> <span class="token namespace">[Convert]</span>::ToBase64String<span class="token punctuation">(</span><span class="token namespace">[Text.Encoding]</span>::ASCII<span class="token punctuation">.</span>GetBytes<span class="token punctuation">(</span><span class="token string">"<span class="token function">$<span class="token punctuation">(</span><span class="token variable">$apikey</span><span class="token punctuation">)</span></span>:"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">       <span class="token punctuation">}</span> <span class="token comment">#end headers hash table</span></span><br><span class="highlight-line">   <span class="token punctuation">}</span> <span class="token comment">#end $params hash table</span></span><br><span class="highlight-line"><span class="token variable">$var</span> = <span class="token function">invoke-restmethod</span> @params</span><br><span class="highlight-line"><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$stoparea</span> in $<span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">.</span>places <span class="token punctuation">|</span>?<span class="token punctuation">{</span> <span class="token variable">$_</span><span class="token punctuation">.</span>embedded_type <span class="token operator">-eq</span> <span class="token string">"stop_area"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span><br><span class="highlight-line"> <span class="token variable">$hash</span> = @<span class="token punctuation">{</span></span><br><span class="highlight-line">        Direction = $<span class="token punctuation">(</span><span class="token variable">$stoparea</span><span class="token punctuation">.</span>Name<span class="token punctuation">)</span></span><br><span class="highlight-line">        idgare = $<span class="token punctuation">(</span><span class="token variable">$stoparea</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span></span><br><span class="highlight-line">    <span class="token punctuation">}</span></span><br><span class="highlight-line">    <span class="token variable">$Object</span> = <span class="token function">New-Object</span> PSObject <span class="token operator">-</span>Property <span class="token variable">$hash</span></span><br><span class="highlight-line">    <span class="token function">Write-Output</span> <span class="token variable">$Object</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">function</span> ConvertTo<span class="token operator">-</span>SncfDateTime</span><br><span class="highlight-line"><span class="token punctuation">{</span></span><br><span class="highlight-line"><span class="token keyword">param</span><span class="token punctuation">(</span></span><br><span class="highlight-line">    <span class="token variable">$sncfdate</span></span><br><span class="highlight-line"><span class="token punctuation">)</span></span><br><span class="highlight-line"><span class="token variable">$sncfyear</span> = <span class="token variable">$sncfdate</span><span class="token punctuation">.</span>Substring<span class="token punctuation">(</span>0<span class="token punctuation">,</span>4<span class="token punctuation">)</span></span><br><span class="highlight-line"><span class="token variable">$sncfmonth</span> = <span class="token variable">$sncfdate</span><span class="token punctuation">.</span>Substring<span class="token punctuation">(</span>4<span class="token punctuation">,</span>2<span class="token punctuation">)</span></span><br><span class="highlight-line"><span class="token variable">$sncfday</span> = <span class="token variable">$sncfdate</span><span class="token punctuation">.</span>Substring<span class="token punctuation">(</span>6<span class="token punctuation">,</span>2<span class="token punctuation">)</span></span><br><span class="highlight-line"><span class="token variable">$sncfhour</span> = <span class="token variable">$sncfdate</span><span class="token punctuation">.</span>Substring<span class="token punctuation">(</span>9<span class="token punctuation">,</span>2<span class="token punctuation">)</span></span><br><span class="highlight-line"><span class="token variable">$sncfminute</span> = <span class="token variable">$sncfdate</span><span class="token punctuation">.</span>Substring<span class="token punctuation">(</span>11<span class="token punctuation">,</span>2<span class="token punctuation">)</span></span><br><span class="highlight-line"><span class="token variable">$sncfsecond</span> = <span class="token variable">$sncfdate</span><span class="token punctuation">.</span>Substring<span class="token punctuation">(</span>13<span class="token punctuation">,</span>2<span class="token punctuation">)</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token variable">$datetime</span> = <span class="token function">Get-date</span> <span class="token operator">-</span>Year <span class="token variable">$sncfyear</span> <span class="token operator">-</span>Day <span class="token variable">$sncfday</span> <span class="token operator">-</span>Month <span class="token variable">$sncfmonth</span> <span class="token operator">-</span>Hour <span class="token variable">$sncfhour</span> <span class="token operator">-</span>Second <span class="token variable">$sncfsecond</span> <span class="token operator">-</span>Minute <span class="token variable">$sncfminute</span></span><br><span class="highlight-line"><span class="token function">Write-Output</span> <span class="token variable">$datetime</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre>

      </main>
      <aside class="aside aside-supplemental d-none d-lg-block col-lg-2 col-xl-2" >
        <nav class="sticky-top">
        
        </nav>
      </aside>
    </div>
  </div>
</div>

    <footer class="site-footer bg-transparent pb-3 pb-md-5">
      <div class="layout-social container d-flex justify-content-center">

  

  

  

  

  

  

  

</div>
    </footer>
  </body>

</html>