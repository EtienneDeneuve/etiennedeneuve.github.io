<!doctype html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
    

    <title>XYZ Blog</title>
    <script defer src="https://use.fontawesome.com/releases/v5.7.2/js/all.js" integrity="sha384-0pzryjIRos8mFBWMzSSZApWtPl/5++eIfzYmTgBBmXYdhvxPc+XcFEk+zJwDgWbP" crossorigin="anonymous"></script>

    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

    
      <script src="https://cdn.jsdelivr.net/npm/vue@2.6.10/dist/vue.min.js"></script>
    

    <script src="/js/script.js"></script>
    </head>
  <body class="position-relative" data-spy="scroll" data-target=".site-nav" data-offset="55">
    <nav class="site-nav family-sans navbar navbar-expand-md navbar-dark  sidebar sticky-top  py-0">
  <div class="container-fluid">
    <button type="button" class="navbar-toggler my-2 my-md-0" data-toggle="collapse" data-target="#myTogglerNav" aria-controls="myTogglerNav" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="navbar-brand text-uppercase">
      <a class="text-light" href="/"><i class="fas fa-cube mr-2"></i>XYZ Blog</a> 
    </div>

    <div class="collapse navbar-collapse text-center mt-0" id="myTogglerNav">
      <div class="navbar-nav ml-auto font-weight-regular text-uppercase">
        
        <a class="d-none nav-item nav-link" href="#page-hero">hero target</a>
        <a class="d-none nav-item nav-link" href="#main-content">nav target</a>
        
        <a class="nav-item nav-link font-weight-bold  text-light" href="/"><i class="fas fa-home"></i></a>
        
          <a class="nav-item nav-link" href="/courses/0/">courses</a>
          
          <a class="nav-item nav-link" href="/posts/0/">posts</a>
          <div class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Projects
          </a>
          <div class="dropdown-menu dropdown-menu-right" aria-labelledby="userDropdown">




          <a class="dropdown-item text-capitalize text-normal" href="/projects/seven/"><i class="fas fa-atom"></i> seven</a><a class="dropdown-item text-capitalize text-normal" href="/projects/rayveal/"><i class="fas fa-atom"></i> rayveal</a></div>
        </div>
        <div class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <i class="fas fa-user"></i>
          </a>
          <div class="dropdown-menu dropdown-menu-right" aria-labelledby="userDropdown">
            <a class="dropdown-item text-capitalize" href="/about">About Me</a>
            <div class="dropdown-divider"></div><a class="dropdown-item text-capitalize" target="_blank" href="https://github.com/etiennedeneuve">
            <i class="fab fa-github text-secondary mr-2"></i>github
          </a><a class="dropdown-item text-capitalize" target="_blank" href="https://linkedin.com/in/etiennedeneuve">
            <i class="fab fa-linkedin text-secondary mr-2"></i>linkedin
          </a><a class="dropdown-item text-capitalize" target="_blank" href="https://twitter.com/etiennedinfo">
            <i class="fab fa-twitter text-secondary mr-2"></i>twitter
          </a></div>
        </div>
      </div>
      <div class="searchbox pl-2 py-2">
    <input
      type="text"
      v-model="query"
      class="form-control text-white border m-auto"
      :class="[isActive ? 'wide' : 'short']"
      @focus="isActive=true"
      @blur.prevent="handleBlur"
      ref="searchinput"
      style="background: transparent;"
      aria-describedby="searchinput"
      autocomplete="off"
    >
    <div v-if="query && isActive" class="position-absolute justify-content-center" style="top: 47px;">
      <div class="card bg-secondary">
        <ul class="list-group list-group-flush px-0" v-for="(item, index) in queried" :key="index">
          <li class="list-group-item">
            <a :href="item.url" class="d-flex text-secondary">
              <span class="pr-2" v-html="item.icon"></span>
              <span class="text-body text-left" v-html="item.title"></span>
            </a>
          </li>
        </ul>
      </div>
    </div>
</div>
    </div>
  </div>
</nav>

      

 
  <div class="post post-sidebar container-fluid">
    <div class="row justify-content-xl-center">
      <aside class="aside aside-main d-none d-md-block col-md-3 col-lg-2">
        <nav class="sticky-top list-group list-group-flush text-right" id="collapseExample">

          </nav>
      </aside>


      <main class="main col">
      <p>Dans cet article, je vous expose mon setup pour Terraform et Ansible, avec git depuis un poste Windows 10.</p>
<!--more-->Si vous ne connaissez pas encore Git, je vous invite à lire mes articles à ce sujet :
<ul>
<li><a href="https://etienne.deneuve.xyz/2018/06/23/git-pour-ops-par-un-ops/">Git for ops</a></li>
<li><a href="https://etienne.deneuve.xyz/2018/06/28/git-pour-les-ops-par-un-ops-le-retour/">Git for ops, le retour</a><br>
Si c'est Visual Studio Code c'est par <a href="https://etienne.deneuve.xyz/2017/01/26/visual-studio-code-pour-ansible-terraform/">ici</a></li>
</ul>
<p>Et sinon, pour aller plus loin, lisez mon article sur <a href="https://etienne.deneuve.xyz/2018/06/26/documentation-as-code/">Documentation as Code</a></p>
<h2 id="visual-studio-code">Visual Studio Code <a class="direct-link" href="#visual-studio-code"> </a></h2>
<p>Créer un nouveau workspace :</p>
<p>Ouvrez un dossier git ou un vide puis sauvegarder le workspace via &quot;File --&gt; Save workspace as&quot;</p>
<p>Dans la configuration du workspace Crtl + P : &quot; &gt; Open Workspace Settings&quot;  et ajoutez :</p>
<pre class="language-json"><code class="language-json"><span class="highlight-line">settings<span class="token operator">:</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">&amp;quot;terminal.integrated.shell.windows&amp;quot;<span class="token operator">:</span> &amp;quot;c<span class="token operator">:</span>\\windows\\System<span class="token number">32</span>\\bash.exe&amp;quot;</span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre>
<p>Et relancez VS Code ;)</p>
<h2>Configuration de Bash</h2>
Il existe pleins de tuto pour installer Bash sur Windows, je ne reviens pas là-dessus, mais voici tout de même un liens vers le store pour un <a href="https://www.microsoft.com/store/productId/9NBLGGH4MSV6">Ubuntu </a>
<p>Je vous donne un petit script bash pour installer les différents packages que j'utilise pour Bash, vous pouvez également installer <a href="https://github.com/Bash-it/bash-it">bash-it</a> :</p>
<pre><code>#!/bin/bash
echo &amp;quot;installation des packages de puis les depots ubuntu&amp;quot;
sudo apt install git wget unzip python curl python-dev build-essential -q -y
echo &amp;quot;Téléchargement de pip&amp;quot;
wget https://bootstrap.pypa.io/get-pip.py
echo &amp;quot;Téléchargement de Terraform&amp;quot;
wget https://releases.hashicorp.com/terraform/0.11.7/terraform_0.11.7_linux_amd64.zip -O terraform.zip
echo &amp;quot;Téléchargement de Terraform Docs&amp;quot;
wget https://github.com/segmentio/terraform-docs/releases/download/v0.3.0/terraform-docs_linux_amd64 -O terraform-docs
echo &amp;quot;Ajout de Terraform et Terraform-docs dans /home/${USER}/.local/bin/&amp;quot;
unzip terraform.zip
mv terraform /home/${USER}/.local/bin/
mv terraform-docs /home/${USER}/.local/bin/
echo &amp;quot;installation de pip en mode user&amp;quot;
python get-pip.py --user
echo &amp;quot;verification du path&amp;quot;
if [[ &amp;quot;:$PATH:&amp;quot; == *&amp;quot;:$HOME/.local/bin&amp;quot;* ]]; then
echo &amp;quot;Your path is correctly set&amp;quot;
else
echo &amp;quot;Ajout de /home/${USER}/.local/bin dans le path&amp;quot;
PATH=$PATH:/home/${USER}/.local/bin
export PATH
fi
echo &amp;quot;Mise a jour de pip par pip&amp;quot;
pip install pip --upgrade --user
echo &amp;quot;installation des outils pour ansible&amp;quot;
pip install ansible-lint ansible-docgen pre-commit ansible[azure] pywinrm molecule --user
</code></pre>
<h2 id="configuration-de-pre-commit">Configuration de Pre-Commit <a class="direct-link" href="#configuration-de-pre-commit"> </a></h2>
<p>Pre-commit permet d'exécuter des petits tests sur le code lors du commit dans un hooks &quot;pre-commit&quot;.</p>
<p>Dans le repo Git, ajoutez un fichier .pre-commit-config.yaml, c'est lui qui indiquera à pre-commit ce qu'il doit configurer dans git (.git/hooks) :</p>
<p>Wordpress ne conservant pas bien les espaces je vous invite a récupérer une version sur mon GitHub <a href="https://raw.githubusercontent.com/EtienneDeneuve/vsts-for-ops/master/.pre-commit-config.yaml">ici</a></p>
<pre><code>cat &amp;lt;./.pre-commit-config.yaml
---
repos:
- repo: https://github.com/pre-commit/pre-commit-hooks
rev: v1.3.0
hooks:
- id: check-yaml
- id: check-xml
- id: check-json
- id: end-of-file-fixer
- id: check-case-conflict
- id: check-merge-conflict
#- id: check-executables-have-shebangs
- id: check-added-large-files
- id: trailing-whitespace
- id: detect-private-key
- id: pretty-format-json
- id: sort-simple-yaml
- repo: https://github.com/willthames/ansible-lint.git
rev: v3.5.0rc1
hooks:
- id: ansible-lint
files: \.(yaml|yml)$
exclude: ./env/
- repo: git://github.com/antonbabenko/pre-commit-terraform
rev: v1.7.3
hooks:
- id: terraform_fmt
- id: terraform_docs
EOF
</code></pre>
<p>Puis on l'ajoute à l'index :</p>
<pre><code>git add .pre-commit-config.yaml
</code></pre>
<p>On commit :</p>
<pre><code>git commit . -m &amp;quot;validation des pré commit hooks&amp;quot; -n
git push origin master
</code></pre>
<p>En suite, on valide l'installation des éléments voulu avec :</p>
<pre><code>pre-commit install
pre-commit installed at /mnt/c/Users/etien/Documents/it/blog/.git/hooks/pre-commit
</code></pre>
<p>et on run sur les fichiers existant :</p>
<pre><code>2018-06-23 10:03:04 ⌚ etienne in /mnt/c/Users/etien/Documents/it/blog
± | master S:7 U:1 ✗| → pre-commit run --all-files
Check Yaml...............................................................Passed
Check Xml............................................(no files to check)Skipped
Check JSON...........................................(no files to check)Skipped
Fix End of Files.........................................................Passed
Check for case conflicts.................................................Passed
Check for merge conflicts................................................Passed
Check for added large files..............................................Passed
Trim Trailing Whitespace.................................................Passed
Detect Private Key.......................................................Passed
Pretty format JSON...................................(no files to check)Skipped
Sort simple YAML files...............................(no files to check)Skipped
Ansible-lint.............................................................Passed
Terraform fmt............................................................Passed
Terraform docs...........................................................Passed
</code></pre>
<h2 id="test-avec-git">Test avec git <a class="direct-link" href="#test-avec-git"> </a></h2>
<p>Ajoutez un fichier à l'index avec <code>git add fichier.yml</code> avec ce contenu :</p>
<pre><code>---
- name: Check Installed Updates
win_updates:
category_names:
- SecurityUpdates
- CriticalUpdates
- UpdateRollups
state: searched
log_path: c:\ansible_wu1.txt
register: search_updates
tags:
- updates
</code></pre>
<p>J'ai volontairement ajouté des espaces qui ne sont peut-être pas visible avec Wordpress, dans ce cas utiliser un playbook ansible <a href="https://raw.githubusercontent.com/EtienneDeneuve/Azure/master/Ansible/inventory/init.yml">ici</a></p>
<p>Et tentez de faire un commit :</p>
<pre><code>git commit .
Check Yaml...............................................................Passed
Check Xml............................................(no files to check)Skipped
Check JSON...........................................(no files to check)Skipped
Fix End of Files.........................................................Passed
Check for case conflicts.................................................Passed
Check for merge conflicts................................................Passed
Check for added large files..............................................Passed
Trim Trailing Whitespace.................................................Failed
hookid: trailing-whitespace

Files were modified by this hook. Additional output:

Fixing test.yml

Detect Private Key.......................................................Passed
Pretty format JSON...................................(no files to check)Skipped
Sort simple YAML files...............................(no files to check)Skipped
Ansible-lint.............................................................Passed
Terraform fmt........................................(no files to check)Skipped
Terraform docs.......................................(no files to check)Skipped
</code></pre>
<p>Le hook de pre-commit trim trailing whitespace a nettoyer les espaces en trop dans votre fichier. Il vous faudra donc ajouter à nouveau le fichier de test à l'index avec un <code>git add test.yml</code>, puis faite un nouveau commit :</p>
<pre><code>git add test.yml
git commit . -m &amp;quot;Test&amp;quot;
Check Yaml...............................................................Passed
Check Xml............................................(no files to check)Skipped
Check JSON...........................................(no files to check)Skipped
Fix End of Files.........................................................Passed
Check for case conflicts.................................................Passed
Check for merge conflicts................................................Passed
Check for added large files..............................................Passed
Trim Trailing Whitespace.................................................Passed
Detect Private Key.......................................................Passed
Pretty format JSON...................................(no files to check)Skipped
Sort simple YAML files...............................(no files to check)Skipped
Ansible-lint.............................................................Passed
Terraform fmt........................................(no files to check)Skipped
Terraform docs.......................................(no files to check)Skipped
[master 8a6cf31] Adding test.yml
1 files changed, 10 insertions(+), 0 deletions(-)
create mode 100644 test.yml
</code></pre>
<p>Voila, maintenant vous savez comment installer des hooks de pre-commit pour faire une pré-validation.</p>
<p>Pour aller un peu plus loin, je vous invite à lire mon article sur la gestion automatique de la documentation avec Terraform-Docs et Ansible-Docgen.</p>

      </main>
      <aside class="aside aside-supplemental d-none d-lg-block col-lg-2 col-xl-2" >
        <nav class="sticky-top">
        <div class="">
                <ol>
                    
                    <li><a href="#visual-studio-code">Visual Studio Code  </a>
            		</li>

                    <li><a href="#configuration-de-pre-commit">Configuration de Pre-Commit  </a>
            		</li>

                    <li><a href="#test-avec-git">Test avec git  </a>
            		</li>
                </ol>
            </div>
        </nav>
      </aside>
    </div>
  </div>
</div>

    <footer class="site-footer bg-transparent pb-3 pb-md-5">
      <div class="layout-social container d-flex justify-content-center">

  

  

  

  

  

  

  

</div>
    </footer>
  </body>

</html>