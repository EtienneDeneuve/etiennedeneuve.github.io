<!doctype html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
    

    <title>XYZ Blog</title>
    <script defer src="https://use.fontawesome.com/releases/v5.7.2/js/all.js" integrity="sha384-0pzryjIRos8mFBWMzSSZApWtPl/5++eIfzYmTgBBmXYdhvxPc+XcFEk+zJwDgWbP" crossorigin="anonymous"></script>

    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

    
      <script src="https://cdn.jsdelivr.net/npm/vue@2.6.10/dist/vue.min.js"></script>
    

    <script src="/js/script.js"></script>
    </head>
  <body class="position-relative" data-spy="scroll" data-target=".site-nav" data-offset="55">
    <nav class="site-nav family-sans navbar navbar-expand-md navbar-dark  sidebar sticky-top  py-0">
  <div class="container-fluid">
    <button type="button" class="navbar-toggler my-2 my-md-0" data-toggle="collapse" data-target="#myTogglerNav" aria-controls="myTogglerNav" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="navbar-brand text-uppercase">
      <a class="text-light" href="/"><i class="fas fa-cube mr-2"></i>XYZ Blog</a> 
    </div>

    <div class="collapse navbar-collapse text-center mt-0" id="myTogglerNav">
      <div class="navbar-nav ml-auto font-weight-regular text-uppercase">
        
        <a class="d-none nav-item nav-link" href="#page-hero">hero target</a>
        <a class="d-none nav-item nav-link" href="#main-content">nav target</a>
        
        <a class="nav-item nav-link font-weight-bold  text-light" href="/"><i class="fas fa-home"></i></a>
        
          <a class="nav-item nav-link" href="/courses/0/">courses</a>
          
          <a class="nav-item nav-link" href="/posts/0/">posts</a>
          <div class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Projects
          </a>
          <div class="dropdown-menu dropdown-menu-right" aria-labelledby="userDropdown">




          <a class="dropdown-item text-capitalize text-normal" href="/projects/seven/"><i class="fas fa-atom"></i> seven</a><a class="dropdown-item text-capitalize text-normal" href="/projects/rayveal/"><i class="fas fa-atom"></i> rayveal</a></div>
        </div>
        <div class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <i class="fas fa-user"></i>
          </a>
          <div class="dropdown-menu dropdown-menu-right" aria-labelledby="userDropdown">
            <a class="dropdown-item text-capitalize" href="/about">About Me</a>
            <div class="dropdown-divider"></div><a class="dropdown-item text-capitalize" target="_blank" href="https://github.com/etiennedeneuve">
            <i class="fab fa-github text-secondary mr-2"></i>github
          </a><a class="dropdown-item text-capitalize" target="_blank" href="https://linkedin.com/in/etiennedeneuve">
            <i class="fab fa-linkedin text-secondary mr-2"></i>linkedin
          </a><a class="dropdown-item text-capitalize" target="_blank" href="https://twitter.com/etiennedinfo">
            <i class="fab fa-twitter text-secondary mr-2"></i>twitter
          </a></div>
        </div>
      </div>
      <div class="searchbox pl-2 py-2">
    <input
      type="text"
      v-model="query"
      class="form-control text-white border m-auto"
      :class="[isActive ? 'wide' : 'short']"
      @focus="isActive=true"
      @blur.prevent="handleBlur"
      ref="searchinput"
      style="background: transparent;"
      aria-describedby="searchinput"
      autocomplete="off"
    >
    <div v-if="query && isActive" class="position-absolute justify-content-center" style="top: 47px;">
      <div class="card bg-secondary">
        <ul class="list-group list-group-flush px-0" v-for="(item, index) in queried" :key="index">
          <li class="list-group-item">
            <a :href="item.url" class="d-flex text-secondary">
              <span class="pr-2" v-html="item.icon"></span>
              <span class="text-body text-left" v-html="item.title"></span>
            </a>
          </li>
        </ul>
      </div>
    </div>
</div>
    </div>
  </div>
</nav>

      

 
  <div class="post post-sidebar container-fluid">
    <div class="row justify-content-xl-center">
      <aside class="aside aside-main d-none d-md-block col-md-3 col-lg-2">
        <nav class="sticky-top list-group list-group-flush text-right" id="collapseExample">

          </nav>
      </aside>


      <main class="main col">
      <h1 id="terraform-your-dns">Terraform your DNS <a class="direct-link" href="#terraform-your-dns"> </a></h1>
<p>In this blog post, I post my article posted on Cellenza Blog, translated in English. The french version is <a href="https://blog.cellenza.com/cloud-2/azure/comment-utiliser-hashicorp-terraform-pour-gerer-vos-dns-bind9-dans-azure/">here</a>.</p>
<p>The purpose of this blog post is to deploy and configure a Bind9 DNS Server in your Azure subscription and make it able to receive DNS Update form Terraform. I'm pretty sure that you will understand why it's so cool ! If not, the goal is to be able to have local DNS that you can manage when you deploy new resources in Azure. Of course, it can work in many other cloud or on premise environment as Bind9 is real standard DNS.</p>
<blockquote>
<p>The way is give is volontary simplified. To make it good for production you need to add a control VM and not expose your DNS directly with a public IP. It's only a proof of concept</p>
</blockquote>
<!--more-->
<h2 id="terraform-dns-provider">Terraform DNS Provider <a class="direct-link" href="#terraform-dns-provider"> </a></h2>
<p>In Terraform plugins, there's a DNS Provider who help to manipulate a DNS correctly setted according to RFC 2136 and 2845. Thoses RFC normalize dns dynamic updates, this is normally used with a DHCP.</p>
<h2 id="cloud-init">Cloud Init <a class="direct-link" href="#cloud-init"> </a></h2>
<p>We will use <a href="https://cloud-init.io/">Cloud Init</a> for primary setup of our Labs, Cloud Init will be lauchned in the very low boot stage.</p>
<h2 id="building-the-folder-structure-for-the-poc">Building the folder structure for the POC <a class="direct-link" href="#building-the-folder-structure-for-the-poc"> </a></h2>
<p>Open Visual Studio Code and create a base folder <code>$workdir</code> and create the folling files &amp; folders :</p>
<pre class="language-text"><code class="language-text"><span class="highlight-line">- bind</span><br><span class="highlight-line">   - main.tf</span><br><span class="highlight-line">   - files/cloudconfig.tpl</span><br><span class="highlight-line">   - data.tf</span><br><span class="highlight-line">   - variables.tf</span><br><span class="highlight-line">   - provider.tf</span><br><span class="highlight-line">- dns</span><br><span class="highlight-line">   - main.tf</span><br><span class="highlight-line">   - provider.tf</span></code></pre>
<h2 id="deploy-bind9-vm">Deploy Bind9 VM <a class="direct-link" href="#deploy-bind9-vm"> </a></h2>
<h3 id="terraform">Terraform <a class="direct-link" href="#terraform"> </a></h3>
<p>In the file <code>bind/provider.tf</code>, add this :</p>
<pre><code>provider &amp;quot;azurerm&amp;quot; {
version = &amp;quot;1.6.0&amp;quot;
}

provider &amp;quot;template&amp;quot; {
version = &amp;quot;1.0.0&amp;quot;
}
</code></pre>
<p>In <code>bind/data.tf</code>, add this :</p>
<pre><code>data &amp;quot;template_cloudinit_config&amp;quot; &amp;quot;config&amp;quot; {
gzip = true
base64_encode = true

part {
content_type = &amp;quot;text/cloud-config&amp;quot;
content = &amp;quot;${data.template_file.cloudconfig.rendered}&amp;quot;
}
}

data &amp;quot;template_file&amp;quot; &amp;quot;cloudconfig&amp;quot; {
template = &amp;quot;${file(&amp;quot;cloudconfig.tpl&amp;quot;)}&amp;quot;
}
</code></pre>
<p>And in <code>bind/main.tf</code> add this (don't forget to change ```` by a secure password) :</p>
<pre><code>resource &amp;quot;azurerm_resource_group&amp;quot; &amp;quot;tf-bind&amp;quot; {
name = &amp;quot;RG-bind&amp;quot;
location = &amp;quot;West Europe&amp;quot;

tags = {
Project = &amp;quot;bind&amp;quot;
}
}

resource &amp;quot;azurerm_virtual_network&amp;quot; &amp;quot;tf-vnet&amp;quot; {
name = &amp;quot;vnet-bind&amp;quot;
location = &amp;quot;${azurerm_resource_group.tf-bind.location}&amp;quot;
resource_group_name = &amp;quot;${azurerm_resource_group.tf-bind.name}&amp;quot;
address_space = [&amp;quot;10.0.0.0/16&amp;quot;]

tags = {
Project = &amp;quot;bind&amp;quot;
}
}

resource &amp;quot;azurerm_subnet&amp;quot; &amp;quot;tf-snet&amp;quot; {
name = &amp;quot;main&amp;quot;
resource_group_name = &amp;quot;${azurerm_resource_group.tf-bind.name}&amp;quot;
virtual_network_name = &amp;quot;${azurerm_virtual_network.tf-vnet.name}&amp;quot;
address_prefix = &amp;quot;10.0.0.0/24&amp;quot;
}

resource &amp;quot;azurerm_virtual_machine&amp;quot; &amp;quot;tf-vm-bind&amp;quot; {
count = 1
name = &amp;quot;bind-vm0${count.index}&amp;quot;
location = &amp;quot;${azurerm_resource_group.tf-bind.location}&amp;quot;
resource_group_name = &amp;quot;${azurerm_resource_group.tf-bind.name}&amp;quot;
network_interface_ids = [&amp;quot;${element(azurerm_network_interface.tf-nic.*.id, count.index)}&amp;quot;]
vm_size = &amp;quot;Standard_B1ms&amp;quot;
delete_os_disk_on_termination = true

storage_image_reference {
publisher = &amp;quot;Canonical&amp;quot;
offer = &amp;quot;UbuntuServer&amp;quot;
sku = &amp;quot;16.04-LTS&amp;quot;
version = &amp;quot;latest&amp;quot;
}

storage_os_disk {
name = &amp;quot;dsk-vm0${count.index}&amp;quot;
caching = &amp;quot;ReadWrite&amp;quot;
create_option = &amp;quot;FromImage&amp;quot;
managed_disk_type = &amp;quot;Standard_LRS&amp;quot;
}

os_profile {
computer_name = &amp;quot;bind-vm0${count.index}&amp;quot;
admin_username = &amp;quot;edeneuve&amp;quot;
admin_password = &amp;quot;&amp;quot;
custom_data = &amp;quot;${data.template_cloudinit_config.config.rendered}&amp;quot;
}

os_profile_linux_config {
disable_password_authentication = false
}

tags = {
Project = &amp;quot;bind&amp;quot;
}
}

resource &amp;quot;azurerm_network_interface&amp;quot; &amp;quot;tf-nic&amp;quot; {
count = &amp;quot;1&amp;quot;
name = &amp;quot;nic-vm${count.index}&amp;quot;
resource_group_name = &amp;quot;${azurerm_resource_group.tf-bind.name}&amp;quot;
location = &amp;quot;${azurerm_resource_group.tf-bind.location}&amp;quot;

ip_configuration {
name = &amp;quot;ipconfig&amp;quot;
private_ip_address_allocation = &amp;quot;dynamic&amp;quot;
subnet_id = &amp;quot;${azurerm_subnet.tf-snet.id}&amp;quot;
public_ip_address_id = &amp;quot;${element(azurerm_public_ip.MyResource.*.id, count.index)}&amp;quot;
}

tags = {
Project = &amp;quot;bind&amp;quot;
}
}

resource &amp;quot;azurerm_public_ip&amp;quot; &amp;quot;MyResource&amp;quot; {
count = &amp;quot;1&amp;quot;
name = &amp;quot;pip-vm${count.index}&amp;quot;
resource_group_name = &amp;quot;${azurerm_resource_group.tf-bind.name}&amp;quot;
location = &amp;quot;${azurerm_resource_group.tf-bind.location}&amp;quot;
public_ip_address_allocation = &amp;quot;dynamic&amp;quot;

tags = {
Project = &amp;quot;bind&amp;quot;
}
}
</code></pre>
<p>In the cloud config template <code>bind/files/cloudconfig.tpl</code>, add this:</p>
<pre><code>#cloud-config
package_upgrade: true
packages:
- bind9
- dnsutils
</code></pre>
<p>Let's deploy !<br>
First connect you to Azure using <code>az login</code>, secondly launch <code>terraform init</code> from the bind folder, then test your copy/paste with <code>terraform plan</code> and finally <code>terraform apply</code>. Take a coffee, your Bind server is under construction.</p>
<h3 id="bind-setup">Bind setup <a class="direct-link" href="#bind-setup"> </a></h3>
<p>Connect you on the newly deploy vm using SSH and go to <code>/etc/bind/</code> and generate a key using <code>sudo rndc-confgen</code></p>
<p>You should now have a <code>rdnc.key</code> within the current folder and with some content like :</p>
<pre><code>$ sudo cat /etc/bind/rndc.key

key &amp;quot;rndc-key&amp;quot; {
algorithm hmac-md5;
secret &amp;quot;REDACTED&amp;quot;;
};
</code></pre>
<p>Now, we will edit the config file of Bind9, the main config is <code>named.conf</code>. You need to add a reference to the new <code>rndc.key</code> :</p>
<pre><code>include &amp;quot;/etc/bind/rndc.key&amp;quot;;
</code></pre>
<p>Then, create new zone in <code>named.conf.local</code> (You can change the <code>toto.int.local.</code> by something different :</p>
<pre><code>zone &amp;quot;toto.int.local.&amp;quot; {
type master;
file &amp;quot;/etc/bind/zones/db.toto.int.local&amp;quot;;
update-policy {
grant rndc-key zonesub any;
};
};
</code></pre>
<p>Finally, create a new zone file in a subfolder called <code>zones</code> (create it) and add the following content in a zone file <code>/etc/bind/zones/db.toto.int.local</code> (name must match with the &quot;file&quot; directive in the <code>named.conf.local</code>) :</p>
<blockquote>
<p>NS must match your server hostname and records must be correct to.</p>
</blockquote>
<pre><code>$ORIGIN .
$TTL 3600       ; 1 hour
toto.int.local          IN SOA  ns1.toto.int.local. root.toto.int.local. (
                                2012033116 ; serial
                                3600       ; refresh (1 hour)
                                1800       ; retry (30 minutes)
                                604800     ; expire (1 week)
                                43200      ; minimum (12 hours)
                                )
                        NS      ns1.toto.int.local.
                        NS      ns2.toto.int.local.
$ORIGIN toto.int.local.
$TTL 3600       ; 1 hour
ns1                     A       137.117.141.166
ns2                     A       137.117.141.166
</code></pre>
<p>As Bind need to create and modify the content in the folder you need to setup right according to :</p>
<pre><code>sudo chown -R root:bind ./zones
sudo chmod -R 640 ./zones
</code></pre>
<p>And then restart bind using :</p>
<pre><code>sudo systemctl restart bind9
</code></pre>
<p>Check the bind logs using :</p>
<pre><code>tail /var/log/syslog | grep named

Jun 15 07:44:25 bind-vm00 named[4233]: automatic empty zone: 255.255.255.255.IN-ADDR.ARPA
Jun 15 07:44:25 bind-vm00 named[4233]: automatic empty zone: 0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.IP6.ARPA
Jun 15 07:44:25 bind-vm00 named[4233]: automatic empty zone: 1.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.IP6.ARPA
Jun 15 07:44:25 bind-vm00 named[4233]: automatic empty zone: D.F.IP6.ARPA
Jun 15 07:44:25 bind-vm00 named[4233]: automatic empty zone: 8.E.F.IP6.ARPA
Jun 15 07:44:25 bind-vm00 named[4233]: automatic empty zone: 9.E.F.IP6.ARPA
Jun 15 07:44:25 bind-vm00 named[4233]: automatic empty zone: A.E.F.IP6.ARPA
Jun 15 07:44:25 bind-vm00 named[4233]: automatic empty zone: B.E.F.IP6.ARPA
Jun 15 07:44:25 bind-vm00 named[4233]: automatic empty zone: 8.B.D.0.1.0.0.2.IP6.ARPA
Jun 15 07:44:25 bind-vm00 named[4233]: automatic empty zone: EMPTY.AS112.ARPA
Jun 15 07:44:25 bind-vm00 named[4233]: configuring command channel from &amp;#039;/etc/bind/rndc.key&amp;#039;
Jun 15 07:44:25 bind-vm00 named[4233]: command channel listening on 127.0.0.1#953
Jun 15 07:44:25 bind-vm00 named[4233]: configuring command channel from &amp;#039;/etc/bind/rndc.key&amp;#039;
Jun 15 07:44:25 bind-vm00 named[4233]: command channel listening on ::1#953
Jun 15 07:44:25 bind-vm00 named[4233]: managed-keys-zone: loaded serial 13
Jun 15 07:44:25 bind-vm00 named[4233]: zone 0.in-addr.arpa/IN: loaded serial 1
Jun 15 07:44:25 bind-vm00 named[4233]: zone 127.in-addr.arpa/IN: loaded serial 1
Jun 15 07:44:25 bind-vm00 named[4233]: zone 255.in-addr.arpa/IN: loaded serial 1
Jun 15 07:44:25 bind-vm00 named[4233]: zone localhost/IN: loaded serial 2
Jun 15 07:44:25 bind-vm00 named[4233]: zone toto.int.local/IN: loaded serial 2012033116
Jun 15 07:44:25 bind-vm00 named[4233]: all zones loaded
Jun 15 07:44:25 bind-vm00 named[4233]: running
Jun 15 07:44:25 bind-vm00 named[4233]: zone toto.int.local/IN: sending notifies (serial 2012033116)
</code></pre>
<p>AppArmor need to be updated to let bind change the zones, so you need to set it. To set AppArmor, you need to change the file <code>/etc/apparmor.d/usr.sbin.named</code> and add the line <code>/etc/bind/zones/** rw,</code> in this part :</p>
<pre><code>cat /etc/apparmor.d/usr.sbin.named
[...]
# /etc/bind should be read-only for bind
# /var/lib/bind is for dynamically updated zone (and journal) files.
# /var/cache/bind is for slave/stub data, since we&amp;#039;re not the origin of it.
# See /usr/share/doc/bind9/README.Debian.gz
/etc/bind/** r,
/etc/bind/zones/** rw,
/var/lib/bind/** rw,
/var/lib/bind/ rw,
/var/cache/bind/** lrw,
/var/cache/bind/ rw,
[...]
</code></pre>
<p>After the modification restart AppArmor deamon with <code>sudo systemctl restart apparmor</code>, then check the named profile is loaded <code>aa-status</code>.</p>
<pre><code>aa-status
apparmor module is loaded.
14 profiles are loaded.
14 profiles are in enforce mode.
/sbin/dient
/usr/bin/lxc-start
/usr/lib/NetworkManager/nm-dhcp-client.action
/usr/lib/NetworkManager/nm-dhcp-helper
/usr/lib/connman/scripts/dient-script
/usr/lib/lxd/lxd-bridge-proxy
/usr/lib/snapd/snap-confine
/usr/lib/snapd/snap-confine//mount-namespace-capture-helper
/usr/sbin/named
/usr/sbin/tcpdump
lxc-container-default
lxc-container-default-cgns
lxc-container-default-with-mounting
lxc-container-default-with-nesting
0 profiles are in complain mode.
2 processes have profiles defined.
0 processes are in enforce mode.
0 processes are in complain mode.
2 processes are unconfined but have a profile defined.
/sbin/dient (921)
/usr/sbin/named (6523)
</code></pre>
<h2 id="dynamic-dns-update-with-terraform">Dynamic DNS Update With Terraform <a class="direct-link" href="#dynamic-dns-update-with-terraform"> </a></h2>
<p>Now we will work in the <code>dns</code>folder :</p>
<pre><code>- dns
- main.tf
- provider.tf
</code></pre>
<p>In <code>provider.tf</code>, add this :</p>
<pre><code>provider &amp;quot;dns&amp;quot; {
update {
server = &amp;quot;&amp;quot;
key_name = &amp;quot;&amp;quot;
key_algorithm = &amp;quot;hmac-md5&amp;quot;
key_secret = &amp;quot;&amp;quot;
}
}
</code></pre>
<p>Then from the dns folder launch <code>terraform init</code>, to grab the dns plugin.</p>
<p>In the <code>main.tf</code> file add Terraform resources :</p>
<pre><code>resource &amp;quot;dns_a_record_set&amp;quot; &amp;quot;www&amp;quot; {
zone = &amp;quot;toto.int.local.&amp;quot;
name = &amp;quot;www&amp;quot;

addresses = [
&amp;quot;192.168.0.1&amp;quot;,
&amp;quot;192.168.0.2&amp;quot;,
&amp;quot;192.168.0.3&amp;quot;,
]

ttl = 300
}

resource &amp;quot;dns_cname_record&amp;quot; &amp;quot;foo&amp;quot; {
zone = &amp;quot;toto.int.local.&amp;quot;
name = &amp;quot;foo&amp;quot;
cname = &amp;quot;tata.toto.int.local.&amp;quot;
ttl = 300
}

resource &amp;quot;dns_a_record_set&amp;quot; &amp;quot;xxx&amp;quot; {
zone = &amp;quot;toto.int.local.&amp;quot;
name = &amp;quot;tata&amp;quot;
addresses = [&amp;quot;192.168.0.1&amp;quot;]
ttl = 300
}
</code></pre>
<p>Then plan with <code>terraform plan</code> :</p>
<pre><code>Refreshing Terraform state in-memory prior to plan...
The refreshed state will be used to calculate this plan, but will not be
persisted to local or remote state storage.

------------------------------------------------------------------------

An execution plan has been generated and is shown below.
Resource actions are indicated with the following symbols:
+ create

Terraform will perform the following actions:

+ dns_a_record_set.www
id:
addresses.#: &amp;quot;3&amp;quot;
addresses.1737095236: &amp;quot;192.168.0.3&amp;quot;
addresses.2307365224: &amp;quot;192.168.0.1&amp;quot;
addresses.277792978: &amp;quot;192.168.0.2&amp;quot;
name: &amp;quot;www&amp;quot;
ttl: &amp;quot;300&amp;quot;
zone: &amp;quot;toto.int.local.&amp;quot;

+ dns_a_record_set.xxx
id:
addresses.#: &amp;quot;1&amp;quot;
addresses.2307365224: &amp;quot;192.168.0.1&amp;quot;
name: &amp;quot;tata&amp;quot;
ttl: &amp;quot;300&amp;quot;
zone: &amp;quot;toto.int.local.&amp;quot;

+ dns_cname_record.foo
id:
cname: &amp;quot;tata.toto.int.local.&amp;quot;
name: &amp;quot;foo&amp;quot;
ttl: &amp;quot;300&amp;quot;
zone: &amp;quot;toto.int.local.&amp;quot;

Plan: 3 to add, 0 to change, 0 to destroy.

------------------------------------------------------------------------

Note: You didn&amp;#039;t specify an &amp;quot;-out&amp;quot; parameter to save this plan, so Terraform
can&amp;#039;t guarantee that exactly these actions will be performed if
&amp;quot;terraform apply&amp;quot; is subsequently run.
</code></pre>
<p>You can now apply with <code>terraform apply</code>. Check the dns log with <code>cat /var/log/syslog | grep named</code> :</p>
<pre><code>Jun 15 09:02:24 bind-vm00 named[6523]: client XX.xx.XX.XX#61068/key rndc: updating zone &amp;#039;toto.int.local/IN&amp;#039;: deleting rrset at &amp;#039;www.toto.int.local&amp;#039; A
Jun 15 09:02:24 bind-vm00 named[6523]: zone toto.int.local/IN: sending notifies (serial 2012033123)
Jun 15 09:02:24 bind-vm00 named[6523]: client XX.xx.XX.XX#61066/key rndc: updating zone &amp;#039;toto.int.local/IN&amp;#039;: deleting rrset at &amp;#039;foo.toto.int.local&amp;#039; CNAME
Jun 15 09:02:24 bind-vm00 named[6523]: client XX.xx.XX.XX#61067/key rndc: updating zone &amp;#039;toto.int.local/IN&amp;#039;: deleting rrset at &amp;#039;tata.toto.int.local&amp;#039; A
Jun 15 09:02:29 bind-vm00 named[6523]: zone toto.int.local/IN: sending notifies (serial 2012033125)
</code></pre>
<h2 id="test-your-new-record">Test your new record <a class="direct-link" href="#test-your-new-record"> </a></h2>
<p>To validate that the dns have created the new records, you can use your workstation and the <code>nslookup</code> command (from Windows, Linux or macOs)</p>
<pre><code>nslookup -

&amp;gt; www.toto.int.local
&amp;gt; www.toto.int.local.
Serveur : UnKnown
Address: 51.144.181.124

Nom : www.toto.int.local
Addresses: 192.168.0.2
192.168.0.1
192.168.0.3
</code></pre>
<p>Now, you can create a DNS Module and create your VM and add them in your new nice Bind9 server.</p>

      </main>
      <aside class="aside aside-supplemental d-none d-lg-block col-lg-2 col-xl-2" >
        <nav class="sticky-top">
        <div class="">
                <ol>
                    
                    <li><a href="#terraform-dns-provider">Terraform DNS Provider  </a>
            		</li>

                    <li><a href="#cloud-init">Cloud Init  </a>
            		</li>

                    <li><a href="#building-the-folder-structure-for-the-poc">Building the folder structure for the POC  </a>
            		</li>

                    <li><a href="#deploy-bind9-vm">Deploy Bind9 VM  </a>
            
                <ol>
                    
                    <li><a href="#terraform">Terraform  </a>
            		</li>

                    <li><a href="#bind-setup">Bind setup  </a>
            		</li>
                </ol>
            		</li>

                    <li><a href="#dynamic-dns-update-with-terraform">Dynamic DNS Update With Terraform  </a>
            		</li>

                    <li><a href="#test-your-new-record">Test your new record  </a>
            		</li>
                </ol>
            </div>
        </nav>
      </aside>
    </div>
  </div>
</div>

    <footer class="site-footer bg-transparent pb-3 pb-md-5">
      <div class="layout-social container d-flex justify-content-center">

  

  

  

  

  

  

  

</div>
    </footer>
  </body>

</html>